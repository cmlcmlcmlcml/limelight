name: Publish all folders to GitHub Pages

on:
  push:
    branches:
      - main

jobs:
  deploy-folders:
    runs-on: ubuntu-latest
    steps:
      # 1️⃣ Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2️⃣ Find all top-level folders
      - name: List folders
        id: folders
        run: |
          echo "FOLDERS=$(find . -maxdepth 1 -type d ! -name '.' ! -name '.github' ! -name 'node_modules' ! -name '.git' | sed 's|^\./||' | tr '\n' ' ')" >> $GITHUB_ENV
          echo "Found folders: $FOLDERS"

      # 3️⃣ Deploy each folder to the Pages branch
      - name: Deploy all folders
        run: |
          for folder in $FOLDERS; do
            echo "Deploying $folder..."
            gh-pages -d "$folder" -b publish-pages -f "$folder"
          done
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
